@[toc](目录)

# OS调度

## 基本概念

<span  style="color: #5bdaed; ">以线程为调度的基本单位</span>，利用调度算法来进行明智的决策，从而减少调度延迟

## 线程

### 线程的状态

- **Waiting**: 这意味着线程已停止并等待某些事情才能继续。这可能是因为等待硬件（磁盘、网络）、操作系统（系统调用）或同步调用（原子、互斥）等原因。这些类型的延迟是性能不佳的根本原因。
- **Runable**: 这意味着线程需要内核上的时间，以便它可以执行分配给它的机器指令,如果你有很多线程需要时间，那么线程必须等待更长的时间才能获得时间。此外，随着更多线程争夺时间，任何给定线程获得的单独时间都会缩短。这种类型的调度延迟也可能是导致性能不佳的原因。
- **Running**: 这意味着线程已放置在核心上并正在执行其机器指令。按照每个程序希望的，应用程序正在完成相关工作。

### 线程的工作方式

- **CPU密集型**: 这项工作永远不会造成线程可能处于等待状态的情况. 这是一项不断进行计算的工作
- **IO密集型**：这是导致线程进入等待状态的工作。这项工作包括通过网络请求访问资源或对操作系统进行系统调用。如我们访问数据库，进行同步事件（互斥体、原子），这会导致线程进入等待。

### 线程的上下文切换

![](https://github.com/optimistic9527/blog/blob/master/image/threadContextSwitch.png?raw=true)

#### 基本概念

在CPU核心上交换线程的物理行为称为上下文切换。发生上下文切换是在当调度程序从内核中取出一个 Executing 线程并用一个 Runnable Thread 替换它时。从运行队列中选择的线程进入 Executing 状态，被取出的线程可以移回 Runnable 状态（如果它仍然具有运行能力），或进入 Waiting 状态（如果由于 IO-Bound 类型的请求而被替换）。

#### 缺点

上下文切换资源消耗严重，因为在内核上和内核外交换线程需要时间。上下文切换过程中产生的延迟量取决于不同的因素，但花费约1000到约1500纳秒的时间。硬件在平均情况下，在每个核上每纳秒执行12条指令，上下文切换可能会花费约12k到约18k条指令的延迟。本质上，您的程序在上下问切换时正在失去大量执行指令的能力


